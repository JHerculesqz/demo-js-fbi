<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Very NB Topo</title>
    <link type="text/css" rel="stylesheet" href="css/MarvelTopo.css"/>
    <script type="application/javascript" src="lib/konva.js"></script>
    <script type="application/javascript" src="lib/keyboard.min.js"></script>
    <script type="application/javascript" src="lib/jquery-3.2.1.min.js"></script>
    <script type="application/javascript" src="js/_1_stage/MarvelTopoResource.js"></script>
    <script type="application/javascript" src="js/_1_stage/MarvelTopoStage.js"></script>
    <script type="application/javascript" src="js/_2_layer/MarvelTopoLayer.js"></script>
    <script type="application/javascript" src="js/_3_sprite/_1_node/MarvelTopoNodeGroup.js"></script>
    <script type="application/javascript" src="js/_3_sprite/_1_node/MarvelTopoNode.js"></script>
    <script type="application/javascript" src="js/_3_sprite/_2_link/MarvelTopoLinkGroup.js"></script>
    <script type="application/javascript" src="js/_3_sprite/_2_link/MarvelTopoLink.js"></script>
    <script type="application/javascript" src="js/_3_sprite/_3_box/MarvelTopoBoxGroup.js"></script>
    <script type="application/javascript" src="js/_3_sprite/_3_box/MarvelTopoBox.js"></script>
    <script type="application/javascript" src="js/_3_sprite/MarvelTopoSprite.js"></script>
    <script type="application/javascript" src="js/MarvelTopoApi.js"></script>
    <script type="application/javascript" src="js/MarvelTopoUtils.js"></script>
    <script type="application/javascript" src="js/MarvelTopo.js"></script>
    <script>
        $(document).ready(function () {
            //#region Mock

            //#region resources

            var THEME_KEY = "dark";

            var IMG_MAP = {
                nodeGroup: "image/" + THEME_KEY + "/nodeGroup1.svg",
                nodeGroupExpand: "image/" + THEME_KEY + "/nodeGroupExpand.svg",
                node: "image/" + THEME_KEY + "/node1.svg"
            };

            var THEME_DARK = {
                dark: {
                    node: {
                        labelColor: "#fff",
                        selectColor: "rgba(255,255,255,0.25)"
                    },
                    link: {
                        labelColor: "#fff",
                        selectColor: 'rgba(255,255,255,0.75)',
                        linkColor: {
                            linkType1: "#ababb5",
                            linkType2: "#FF4c4c",
                            linkType3: "#ff8833"
                        }
                    }
                }
            };

            //#endregion

            //#region node

            var arrNodeGroup = [];
            for (var i = 0; i < 2; i++) {
                var iX = Math.random() * 400;
                var iY = Math.random() * 200;
                var oNodeGroup = {
                    id: "nodeGroup" + i,
                    x: iX,
                    y: iY,
                    uiImgKey: "nodeGroup",
                    uiImgKey4Expand: "nodeGroupExpand",
                    uiLabel: "nodeGroup" + i,
                    uiExpandNode: false,
                    uiExpandNodeWidth: 200,
                    uiExpandNodeHeight: 200,
                    uiNode: true,
                    opacity: 0,
                    children: [{
                        id: "node" + i + "_1",
                        x: 50,
                        y: 50,
                        uiImgKey: "node",
                        uiLabel: "node" + i + "_1",
                        uiChild: true,
                        uiNode: true
                    }, {
                        id: "node" + i + "_2",
                        x: 100,
                        y: 100,
                        uiImgKey: "node",
                        uiLabel: "node" + i + "_2",
                        uiChild: true,
                        uiNode: true
                    }]
                };
                arrNodeGroup.push(oNodeGroup);
            }

            var arrNode = [];
            for (var i = 0; i < 2; i++) {
                var iX = Math.random() * 400;
                var iY = Math.random() * 200;
                var oNode = {
                    id: "node" + i,
                    x: iX,
                    y: iY,
                    uiImgKey: "node",
                    uiLabel: "node" + i,
                    uiNode: true
                };
                arrNode.push(oNode);
            }

            //#endregion

            //#region link

            for (var i = 0; i < 3; i++) {
                var iX = Math.random() * 400;
                var iY = Math.random() * 200;
                var oNode = {
                    id: "nodeBase" + i,
                    x: iX,
                    y: iY,
                    uiImgKey: "node",
                    uiLabel: "nodeBase" + i,
                    uiNode: true
                };
                arrNode.push(oNode);
            }

            var arrLinkBase = [];
            //region 网元之间的虚链路
            for (var i = 0; i < 3; i++) {
                var oLink = {
                    id: "link" + i,
                    srcNodeId: "nodeBase0",
                    dstNodeId: "nodeBase1",
                    uiLabelL: "nodeBase0",
                    uiLabelM: "link" + i,
                    uiLabelR: "nodeBase1",
                    uiLink: true,
                    uiLinkColorKey: "linkType1",
                    uiLinkWidth: 3,
                    uiDirection: 2,
                    uiDash: [10, 5]
                };
                arrLinkBase.push(oLink);
            }
            //endregion
            //region 网元之间的捆绑链路
            for (var i = 0; i < 2; i++) {
                //oLink1和oLink2为一组
                var oLink1 = {
                    id: "gLink" + i + "_" + i,
                    srcNodeId: "nodeBase" + i,
                    dstNodeId: "nodeBase" + (i + 1),
                    uiLinkGroupId: "groupLink" + i + "_" + i,
                    uiLink: true,
                    uiLinkExpand: false,
                    uiLabelL: "nodeBase" + i,
                    uiLabelM: "gLink" + i + "_" + i,
                    uiLabelR: "nodeBase" + (i + 1),
                    uiLinkColorKey: "linkType2",
                    uiLinkWidth: 3
                };
                var oLink2 = {
                    id: "gLink" + i + "_" + (i + 1),
                    srcNodeId: "nodeBase" + i,
                    dstNodeId: "nodeBase" + (i + 1),
                    uiLinkGroupId: "groupLink" + i + "_" + i,
                    uiLink: true,
                    uiLinkExpand: false,
                    uiLabelL: "nodeBase" + i,
                    uiLabelM: "gLink" + i + "_" + (i + 1),
                    uiLabelR: "nodeBase" + (i + 1),
                    uiLinkColorKey: "linkType2",
                    uiLinkWidth: 3
                };
                //oLink3和oLink4为一组
                var oLink3 = {
                    id: "gLink" + i + "_" + (i + 2),
                    srcNodeId: "nodeBase" + i,
                    dstNodeId: "nodeBase" + (i + 1),
                    uiLinkGroupId: "groupLink" + i + "_" + (i + 1),
                    uiLink: true,
                    uiLinkExpand: false,
                    uiLabelL: "nodeBase" + i,
                    uiLabelM: "gLink" + i + "_" + (i + 2),
                    uiLabelR: "nodeBase" + (i + 1),
                    uiLinkColorKey: "linkType3",
                    uiLinkWidth: 3
                };

                var oLink4 = {
                    id: "gLink" + i + "_" + (i + 3),
                    srcNodeId: "nodeBase" + i,
                    dstNodeId: "nodeBase" + (i + 1),
                    uiLinkGroupId: "groupLink" + i + "_" + (i + 1),
                    uiLink: true,
                    uiLinkExpand: false,
                    uiLabelL: "nodeBase" + i,
                    uiLabelM: "gLink" + i + "_" + (i + 3),
                    uiLabelR: "nodeBase" + (i + 1),
                    uiLinkColorKey: "linkType3",
                    uiLinkWidth: 3
                };

                arrLinkBase.push(oLink1);
                arrLinkBase.push(oLink2);
                arrLinkBase.push(oLink3);
                arrLinkBase.push(oLink4);
            }
            //endregion
            //region 站点内设备与站点外设备之间的链路
            for (var i = 100; i < 101; i++) {
                var oLink1 = {
                    id: "gLink" + i + 0,
                    srcNodeId: "nodeBase2",
                    dstNodeId: "node1_1",
                    uiLabelL: "nodeBase0",
                    uiLabelM: "gLink" + i,
                    uiLabelR: "nodeBase1",
                    uiLinkExpand: false,
                    uiLink: true,
                    uiLinkGroupId: "groupLink" + i + 0,
                    uiLinkColorKey: "linkType2",
                    uiLinkWidth: 3
                };
                var oLink2 = {
                    id: "gLink" + i + 1,
                    srcNodeId: "nodeBase2",
                    dstNodeId: "node1_1",
                    uiLabelL: "nodeBase0",
                    uiLabelM: "gLink" + i,
                    uiLabelR: "nodeBase1",
                    uiLinkExpand: false,
                    uiLink: true,
                    uiLinkGroupId: "groupLink" + i + 0,
                    uiLinkColorKey: "linkType2",
                    uiLinkWidth: 3
                };
                var oLink3 = {
                    id: "gLink" + i + 2,
                    srcNodeId: "nodeBase2",
                    dstNodeId: "node1_2",
                    uiLabelL: "nodeBase0",
                    uiLabelM: "gLink" + i,
                    uiLabelR: "nodeBase1",
                    uiLinkExpand: false,
                    uiLink: true,
                    uiLinkGroupId: "groupLink" + i + 1,
                    uiLinkColorKey: "linkType3",
                    uiLinkWidth: 3
                };
                var oLink4 = {
                    id: "gLink" + i + 3,
                    srcNodeId: "nodeBase2",
                    dstNodeId: "node1_2",
                    uiLabelL: "nodeBase0",
                    uiLabelM: "gLink" + i,
                    uiLabelR: "nodeBase1",
                    uiLinkExpand: false,
                    uiLink: true,
                    uiLinkGroupId: "groupLink" + i + 1,
                    uiLinkColorKey: "linkType3",
                    uiLinkWidth: 3
                };
                arrLinkBase.push(oLink1);
                arrLinkBase.push(oLink2);
                arrLinkBase.push(oLink3);
                arrLinkBase.push(oLink4);
            }
            //endregion
            //region 站点内设备与站点内的设备之间的链路
            for (var i = 200; i < 201; i++) {
                var oLink1 = {
                    id: "gLink" + i + 0,
                    srcNodeId: "node0_1",
                    dstNodeId: "node1_1",
                    uiLabelL: "nodeBase0",
                    uiLabelM: "gLink" + i,
                    uiLabelR: "nodeBase1",
                    uiLinkExpand: false,
                    uiLink: true,
                    uiLinkGroupId: "groupLink" + i + 0,
                    uiLinkColorKey: "linkType2",
                    uiLinkWidth: 3
                };
                var oLink2 = {
                    id: "gLink" + i + 1,
                    srcNodeId: "node0_1",
                    dstNodeId: "node1_1",
                    uiLabelL: "nodeBase0",
                    uiLabelM: "gLink" + i,
                    uiLabelR: "nodeBase1",
                    uiLinkExpand: false,
                    uiLink: true,
                    uiLinkGroupId: "groupLink" + i + 0,
                    uiLinkColorKey: "linkType2",
                    uiLinkWidth: 3
                };
                var oLink3 = {
                    id: "gLink" + i + 2,
                    srcNodeId: "node0_2",
                    dstNodeId: "node1_2",
                    uiLabelL: "nodeBase0",
                    uiLabelM: "gLink" + i,
                    uiLabelR: "nodeBase1",
                    uiLinkExpand: false,
                    uiLink: true,
                    uiLinkGroupId: "groupLink" + i + 1,
                    uiLinkColorKey: "linkType3",
                    uiLinkWidth: 3,
                    uiDirection:2
                };
                var oLink4 = {
                    id: "gLink" + i + 3,
                    srcNodeId: "node0_2",
                    dstNodeId: "node1_2",
                    uiLabelL: "nodeBase0",
                    uiLabelM: "gLink" + i,
                    uiLabelR: "nodeBase1",
                    uiLinkExpand: false,
                    uiLink: true,
                    uiLinkGroupId: "groupLink" + i + 1,
                    uiLinkColorKey: "linkType3",
                    uiLinkWidth: 3,
                    uiDirection:1
                };
                arrLinkBase.push(oLink1);
                arrLinkBase.push(oLink2);
                arrLinkBase.push(oLink3);
                arrLinkBase.push(oLink4);
            }
            //endregion

            //#endregion

            //#endregion

            //#region demo

            //Topo
            var oEventOptions = {
                //region node
                callbackOnNodeClick: function(oNode, oEvent){
                    console.log("callbackOnNodeClick");
                    console.log(oNode);
                    console.log(oEvent);
                },
                //endregion
                //region nodeGroup
                callbackOnNodeGroupClick: function(oNodeGroup, oEvent){
                    console.log("callbackOnNodeGroupClick");
                    console.log(oNodeGroup);
                    console.log(oEvent);
                },
                //endregion
                //region link
                callbackOnLinkGroupClick: function(oLinkGroup, oEvent){
                    console.log("callbackOnLinkGroupClick");
                    console.log(oLinkGroup);
                    console.log(oEvent);
                },
                callbackOnLinkClick: function(oLink, oEvent){
                    console.log("callbackOnLinkClick");
                    console.log(oLink);
                    console.log(oEvent);
                }
                //endregion
            };
            var oTopo = new $.MarvelTopo();
            oTopo.Api.init(oTopo, {
                id: "id1",
                themeKey: THEME_KEY,
                imgMap: IMG_MAP,
                themeSetting: THEME_DARK,
                eventOptions: oEventOptions,
            }, function () {
                oTopo.Api.draw(oTopo, {
                    nodeGroups: arrNodeGroup,
                    nodes: arrNode,
                    links: arrLinkBase
                });
            });

            $("#expandNodeGroup").click(function () {
                oTopo.Api.expandAllNodeGroup(oTopo);
            });
            $("#collapseNodeGroup").click(function () {
                oTopo.Api.collapseAllNodeGroup(oTopo);
            });

            $("#expandLinkGroup").click(function () {
                oTopo.Api.expandAllLinkGroup(oTopo);
            });
            $("#collapseLinkGroup").click(function () {
                oTopo.Api.collapseAllLinkGroup(oTopo);
            });
            $("#selectNodes").click(function () {
                oTopo.Api.selectNodesById(oTopo, ["node0", "node1"]);
            });
            $("#selectLinks").click(function () {
                oTopo.Api.selectLinksById(oTopo, ["link0", "link1", "link2", "gLink1_2"]);
            });
            $("#getTopoData").click(function () {
                var oTopoData = oTopo.Api.getTopoData(oTopo);
                console.log(oTopoData);
            });
            $("#updateTopo").click(function () {
                var oTopoData = oTopo.Api.getTopoData(oTopo);
                var oLink = {
                    id: "link1000",
                    srcNodeId: "nodeBase0",
                    dstNodeId: "nodeBase1",
                    uiLabelL: "nodeBase0",
                    uiLabelM: "link1000",
                    uiLabelR: "nodeBase1",
                    uiLink: true,
                    uiLinkColorKey: "linkType1",
                    uiLinkWidth: 3
                };
                oTopoData.links.push(oLink);
                oTopo.Api.updateTopo(oTopo, oTopoData);
            });
            var createNodeId = "createNodeId1";
            $("#createNode").click(function(){
                oTopo.Api.createNode({
                    id: createNodeId,
                    uiImgKey: "node",
                    uiLabel: createNodeId,
                    uiNode: true
                }, oTopo);
                createNodeId += 1;
            });
            //#endregion
        });
    </script>
</head>
<body>
<button id="expandNodeGroup">expandNodeGroup</button>
<button id="collapseNodeGroup">collapseNodeGroup</button>
<button id="expandLinkGroup">expandLinkGroup</button>
<button id="collapseLinkGroup">collapseLinkGroup</button>
<button id="selectNodes">selectNodes</button>
<button id="selectLinks">selectLinks</button>
<button id="getTopoData">getTopoData</button>
<button id="updateTopo">updateTopo</button>
<button id="createNode">createNode</button>
<div id="id1" style="width:1200px; height:600px;"></div>
</body>
</html>